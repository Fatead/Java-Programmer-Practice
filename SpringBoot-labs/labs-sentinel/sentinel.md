# Sentinel 服务容错
## 流量控制
流量控制用于调整网络包的发送数据，根据系统的处理能力对流量进行控制，Sentinel
作为一个调配器，可以根据需要把随机的请求调整成合适的形状。
监控应用流量的QPS或并发线程数等指标，当达到指定的阈值时对流量进行控制，以避免被
瞬时的流量高峰冲垮，从而保障应用的高可用性。
限流的直接表现时在执行Entry nodeA = SphU.entry(resourceName) 的时候抛出 FlowException 异常。FlowException 是 BlockException 的子类，可以捕捉 BlockException 来自定义被限流之后的处理逻辑。
![img.png](./img/img.png)
流量控制有一下几个角度：
+ 资源的调用关系，例如资源的调用链路，资源和资源之间的关系
+ 运行指标，例如QPS、线程池、系统负载等
+ 控制的效果，例如直接限流、冷启动、排队等

## Sentinel的主要特性

![img.png](./img/img2.png)

## Sentinel的组成

Sentinel分为两个部分
+ 核心库（Java客户端）：不依赖任何框架/库，能够运行所有Java运行时环境。
+ 控制台 启动控制台的命令为：nohup java -Dserver.port=7070 -jar sentinel-dashboard-1.8.1.jar &

## 熔断降级
Sentinel和Hystrix的原则是一致的：当检测到调用链路中某个资源出现不稳定的表现，例如请求响应时间长或异常比例升高
的时候，对这个资源的调用进行限制，让请求快速失败，避免影响到其他资源而导致的级联故障。

在限制的手段上，Sentinel和Hystrix采取了完全不一样的方法。Hystrix通过线程池隔离的方式，来对依赖（在Sentinel中对应资源）进行了
隔离，这样做的好处是资源和资源之间做到了最彻底的隔离。缺点是增加了线程切换的成本。

Sentinel对这个问题采取了两种手段：

1.通过并发线程数进行限制

和资源池隔离的方法不同，Sentinel通过限制资源并发线程的数量，来减少不稳定资源对其他资源的影响。当某个资源出现不稳定的情况下，
例如响应时间变长，对资源的直接影响就是会造成线程数的逐步堆积。当线程数在特定资源上堆积到一定数量之后，
对该资源的新请求就会被拒绝。堆积的线程完成任务后才开始继续接收请求。

2.通过影响时间对资源进行降级

当依赖的资源出现响应时间过长后，所有对该资源的访问都会被直接拒绝，直到过了指定的时间窗口之后才重新恢复。

